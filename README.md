# nopwd

A simple no password library for go for generating login links to send to your user. This library only concerns itself with logging in. Not validation of APIs after you are logged in.  This library generates a link to your website that contains a code in the URL that is:
* validatable with HMAC256 secret
* validates the issuer is the same
* validates the time the code is validated is not beyond the time to life (TTL) you specify (implying the link could be used multiple times before the TTL expires)

```go
// What secret should tokens be validated with?
var secret = "choose something random"
// How long should login links last?
var ttl = 10 
// Global no password
var noPwd = NewNoPwd("https://foo.com",secret,ttl)

func sendCodeToEmail(email string) error {
   // create a login link for an email (e.g https://foo.com/?login_code=ABSDIMOIAd... )
   loginLink := noPwd.GenerateLoginLink(email)
   
   // send login link with whatever tech you use for sending emails (mailgun, etc.)
   ...
}

...

e := echo.New()
e.POST("/send_code", func(c echo.Context) error {
  email := c.QueryParam("email")
  sendCodeToEmail(email)
  return c.String(http.StatusOK, "OK")
})

e.POST("/login", func(c echo.Context) error {
  code := c.QueryParam("login_code")
  valid, email, err := noPwd.ValidateLoginCode(code)
  if valid != true || err != nil {
    return c.String(http.StatusUnauthorized, "Failed to validate code")
  }
  
  // Once validated, send them whatever authorization token you want them to use for your api
  // OR you can use codes generated by NoPwd

  api_code = noPwd.GenerateAPICode(email,43800) // create a code for an email that lasts a month (defined in minutes)

  return c.JSONBlob(http.StatusOK, []byte(`{
    api_code: `+api_code+`
  }`))
})


e.POST("/some_api", func(c echo.Context) error {
  code := c.Request().Headers.Get("MyAuthHeader")
  valid, email, err := noPwd.ValidateAPICode(code)
  if valid != true || err != nil {
    return c.String(http.StatusUnauthorized, "Failed to validate code")
  }
  
  // do something
})
...
````
